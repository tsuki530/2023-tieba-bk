# 百度百科项目文档

## 1. 项目概述

### 1.1 项目背景
百度百科风格社区系统是一个基于Django框架开发的综合性知识管理与社区互动平台。项目结合了百科词条管理、用户社区互动、内容搜索等核心功能，为用户提供专业的知识分享和社区交流体验。

### 1.2 项目目标
- 构建功能完善的百科词条管理系统
- 实现用户注册、登录、内容编辑等核心功能
- 提供良好的百科风格用户界面设计
- 支持全文搜索和内容分类管理
- 确保系统的稳定性和安全性

## 2. 技术架构

### 2.1 技术栈
- **后端框架**: Django 4.2.7 + Django REST Framework 3.14.0
- **数据库**: SQLite3 (开发环境)
- **前端技术**: HTML5 + CSS3 + JavaScript
- **缓存系统**: Redis
- **搜索引擎**: Elasticsearch 8.11.0
- **认证系统**: Django Allauth
- **静态文件**: WhiteNoise
- **异步任务**: Celery
- **实时通信**: Django Channels

### 2.2 项目结构
```
baidu_wiki/
├── baidu_wiki/          # 项目主配置
│   ├── settings.py      # 项目设置
│   ├── urls.py         # 主路由配置
│   └── asgi.py         # ASGI配置
├── users/              # 用户管理应用
├── wiki/               # 百科词条应用
├── posts/              # 社区帖子应用
├── search/             # 搜索功能应用
├── templates/          # 模板文件
│   ├── index.html      # 首页
│   ├── wiki_detail.html # 词条详情页
│   ├── wiki_edit.html  # 词条编辑页
│   ├── search.html     # 搜索页面
│   ├── user_profile.html # 用户资料页
│   └── notifications.html # 通知页面
└── requirements.txt   # 依赖包列表
```

## 3. 核心功能模块

### 3.1 用户管理模块 (users应用)

#### 3.1.1 数据模型
- **CustomUser**: 自定义用户模型，扩展Django内置用户模型
  - 邮箱认证 (email作为用户名)
  - 头像、个人简介、位置等个人信息
  - 粉丝/关注关系统计
  - 活动时间追踪

- **UserProfile**: 用户扩展资料
  - 内容创作统计 (词条创建、编辑、帖子等)
  - 声望系统和等级机制
  - 界面主题和语言偏好

- **Follow**: 用户关注关系
  - 双向关注关系管理
  - 关注时间记录

#### 3.1.2 API接口
- `POST /api/auth/register/` - 用户注册
- `POST /api/auth/login/` - 用户登录
- `GET /api/auth/logout/` - 用户登出
- `GET/PUT /api/auth/profile/` - 用户资料管理
- `POST /api/auth/users/{id}/follow/` - 关注用户
- `GET /api/auth/users/{id}/followers/` - 获取粉丝列表
- `GET /api/auth/users/{id}/following/` - 获取关注列表

### 3.2 百科词条模块 (wiki应用)

#### 3.2.1 数据模型
- **Category**: 词条分类管理
  - 多级分类结构
  - 分类描述和slug

- **Tag**: 词条标签
  - 标签名称和slug

- **Article**: 百科词条
  - 标题、内容、摘要
  - 作者、分类、标签关联
  - 状态管理 (草稿、已发布、已归档)
  - 统计信息 (浏览量、点赞数、评论数)
  - 版本控制和发布时间

- **ArticleVersion**: 词条版本历史
  - 完整版本追踪
  - 变更描述记录

- **ArticleLike**: 词条点赞
- **ArticleBookmark**: 词条收藏
- **ArticleComment**: 词条评论
- **CommentLike**: 评论点赞

#### 3.2.2 API接口
- `GET /api/wiki/articles/` - 获取词条列表
- `POST /api/wiki/articles/` - 创建新词条
- `GET /api/wiki/articles/{id}/` - 获取词条详情
- `PUT /api/wiki/articles/{id}/` - 更新词条
- `DELETE /api/wiki/articles/{id}/` - 删除词条
- `POST /api/wiki/articles/{id}/like/` - 点赞词条
- `POST /api/wiki/articles/{id}/comments/` - 添加评论

### 3.3 社区帖子模块 (posts应用)

#### 3.3.1 数据模型
- **PostCategory**: 帖子分类
- **Post**: 社区帖子
  - 多种帖子类型 (讨论、问题、公告、新闻)
  - 状态管理 (草稿、已发布、已关闭、已归档)
  - 置顶和精华标记
  - 丰富的统计信息

- **PostLike**: 帖子点赞
- **PostComment**: 帖子评论
- **CommentLike**: 评论点赞
- **PostShare**: 帖子分享
- **PostReport**: 内容举报
- **PostTag**: 帖子标签

#### 3.3.2 API接口
- `GET /api/posts/` - 获取帖子列表
- `POST /api/posts/` - 创建新帖子
- `GET /api/posts/{id}/` - 获取帖子详情
- `PUT /api/posts/{id}/` - 更新帖子
- `DELETE /api/posts/{id}/` - 删除帖子

### 3.4 搜索功能模块 (search应用)

#### 3.4.1 功能特性
- 全文搜索支持
- 多字段搜索 (标题、内容、标签等)
- 搜索结果排序和过滤
- 搜索建议和自动补全

#### 3.4.2 API接口
- `GET /api/search/?q=关键词` - 执行搜索
- `GET /api/search/suggest/?q=关键词` - 获取搜索建议

## 4. 系统配置

### 4.1 项目设置 (settings.py)

#### 4.1.1 基础配置
- **语言和时区**: 中文简体，亚洲/上海时区
- **静态文件**: WhiteNoise压缩和缓存
- **媒体文件**: 本地存储配置
- **认证系统**: Django Allauth集成

#### 4.1.2 安全配置
- **CORS设置**: 允许跨域请求
- **缓存配置**: Redis缓存后端
- **邮件配置**: SMTP邮件服务
- **生产环境安全**: HTTPS重定向、安全头设置

#### 4.1.3 应用配置
```python
INSTALLED_APPS = [
    # Django核心应用
    'django.contrib.admin',
    'django.contrib.auth', 
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'django.contrib.sites',
    
    # 第三方应用
    'rest_framework',
    'rest_framework.authtoken',
    'corsheaders',
    'allauth',
    'allauth.account',
    'allauth.socialaccount',
    'crispy_forms',
    'channels',
    
    # 本地应用
    'users',
    'wiki',
    'posts',
    'search',
]
```

### 4.2 路由配置 (urls.py)

#### 4.2.1 页面路由
- `/` - 首页 (index.html)
- `/wiki_detail.html` - 词条详情页
- `/wiki_edit.html` - 词条编辑页
- `/search.html` - 搜索页面
- `/user_profile.html` - 用户资料页
- `/notifications.html` - 通知页面

#### 4.2.2 API路由
- `/api/auth/` - 用户认证相关API
- `/api/wiki/` - 百科词条相关API
- `/api/posts/` - 社区帖子相关API
- `/api/search/` - 搜索功能相关API

## 5. 前端界面设计

### 5.1 首页设计 (index.html)

#### 5.1.1 布局结构
- **响应式网格布局**: 支持桌面和移动设备
- **功能分区**: 百科内容、用户中心、系统管理三大区块
- **搜索功能**: 顶部搜索框，支持回车搜索
- **API接口展示**: 系统API链接集合

#### 5.1.2 视觉设计
- **渐变背景**: 蓝紫色渐变，体现科技感
- **卡片式设计**: 白色卡片，圆角阴影效果
- **交互动效**: 悬停效果、平滑过渡
- **图标系统**: 表情符号图标，直观易懂

### 5.2 页面功能链接

#### 5.2.1 百科内容区块
- **百科词条详情**: 查看完整词条内容
- **百科编辑页面**: 词条编辑和版本管理
- **搜索页面**: 百科内容搜索功能

#### 5.2.2 用户中心区块
- **个人中心**: 用户资料管理
- **消息通知**: 系统消息和互动通知
- **用户认证**: 登录注册和权限管理

#### 5.2.3 系统管理区块
- **管理后台**: Django Admin后台管理
- **帖子管理**: 社区帖子管理接口
- **百科API**: 词条数据接口服务

## 6. 数据库设计

### 6.1 核心数据表关系

```mermaid
erDiagram
    CustomUser ||--o{ Article : "创建"
    CustomUser ||--o{ Post : "创建"
    CustomUser ||--o{ Follow : "关注关系"
    
    Article ||--o{ ArticleVersion : "版本历史"
    Article ||--o{ ArticleComment : "评论"
    Article ||--o{ ArticleLike : "点赞"
    Article ||--o{ ArticleBookmark : "收藏"
    
    Category ||--o{ Article : "分类"
    Tag ||--|| Article : "标签"
    
    Post ||--o{ PostComment : "评论"
    Post ||--o{ PostLike : "点赞"
    Post ||--o{ PostShare : "分享"
    Post ||--o{ PostReport : "举报"
    
    PostCategory ||--o{ Post : "分类"
    PostTag ||--|| Post : "标签"
```

### 6.2 索引优化
- **用户活动索引**: 用户ID + 创建时间
- **内容状态索引**: 状态 + 发布时间
- **分类内容索引**: 分类ID + 创建时间
- **搜索优化索引**: 标题、内容全文索引

## 7. API接口规范

### 7.1 认证机制
- **Session认证**: 浏览器会话认证
- **Token认证**: API接口Token认证
- **权限控制**: 基于角色的权限管理

### 7.2 响应格式
```json
{
    "status": "success",
    "data": {
        // 业务数据
    },
    "message": "操作成功",
    "code": 200
}
```

### 7.3 错误处理
- **400**: 请求参数错误
- **401**: 未授权访问
- **403**: 权限不足
- **404**: 资源不存在
- **500**: 服务器内部错误

## 8. 部署配置

### 8.1 开发环境
- **数据库**: SQLite3
- **调试模式**: DEBUG=True
- **静态文件**: 本地服务
- **缓存**: 本地内存缓存

### 8.2 生产环境
- **数据库**: PostgreSQL/MySQL
- **静态文件**: CDN分发
- **缓存**: Redis集群
- **搜索**: Elasticsearch集群
- **Web服务器**: Gunicorn + Nginx
- **进程管理**: Supervisor

### 8.3 环境变量配置
```bash
# 安全配置
SECRET_KEY=your-secret-key
DEBUG=False
ALLOWED_HOSTS=your-domain.com

# 数据库配置
DATABASE_URL=postgresql://user:pass@host:port/db

# 缓存配置
REDIS_URL=redis://host:port/db

# 邮件配置
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_HOST_USER=your-email@gmail.com
EMAIL_HOST_PASSWORD=your-app-password

# 搜索配置
ELASTICSEARCH_HOSTS=localhost:9200
```

## 9. 开发指南

### 9.1 环境搭建
```bash
# 克隆项目
git clone <repository-url>
cd 2023-tieba-bk

# 创建虚拟环境
python -m venv venv
source venv/bin/activate  # Linux/Mac
venv\Scripts\activate     # Windows

# 安装依赖
pip install -r requirements.txt

# 数据库迁移
python manage.py migrate

# 创建超级用户
python manage.py createsuperuser

# 启动开发服务器
python manage.py runserver
```

### 9.2 代码规范
- **Python代码**: PEP 8规范
- **Django模型**: 使用verbose_name
- **API设计**: RESTful规范
- **前端代码**: 语义化HTML，模块化CSS

### 9.3 测试策略
- **单元测试**: 模型和业务逻辑测试
- **集成测试**: API接口测试
- **功能测试**: 用户界面测试
- **性能测试**: 负载和压力测试

## 10. 项目特色

### 10.1 技术特色
- **混合架构**: 传统MVC + REST API
- **模块化设计**: 功能模块清晰分离
- **扩展性强**: 易于添加新功能模块
- **性能优化**: 缓存、索引、异步任务

### 10.2 功能特色
- **百科社区融合**: 知识管理 + 社区互动
- **版本控制**: 完整的词条编辑历史
- **社交功能**: 关注、点赞、评论系统
- **搜索优化**: 全文搜索和智能建议

### 10.3 用户体验
- **响应式设计**: 多设备兼容
- **直观界面**: 卡片式布局，图标引导
- **快速导航**: 功能分区，一键直达
- **交互反馈**: 丰富的交互动效

## 11. 后续开发计划

### 11.1 短期目标
- [ ] 完善搜索功能实现
- [ ] 优化用户界面为百科风格
- [ ] 测试所有百科相关功能
- [ ] 添加词条分类和标签管理

### 11.2 中期目标
- [ ] 实现实时通知系统
- [ ] 添加词条协作编辑功能
- [ ] 集成第三方登录
- [ ] 开发移动端应用

### 11.3 长期目标
- [ ] 构建知识图谱系统
- [ ] 实现智能推荐算法
- [ ] 支持多语言版本
- [ ] 建立开发者生态系统

---

**文档版本**: 1.0  
**最后更新**: 2024年  
**项目状态**: 开发中  
**维护团队**: 百度百科项目组